# .github/workflows/daily-pr.yml
name: Daily PR from develop to main

on:
  schedule:
    - cron: "0 6 * * *" # 8 AM Amsterdam (summer, CEST)
    - cron: "0 7 * * *" # 8 AM Amsterdam (winter, CET)
  workflow_dispatch: # allow manual trigger

permissions:
  contents: write
  pull-requests: write

jobs:
  create-pr:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Ensure both branches exist locally
        run: |
          git fetch origin main:main || true
          git fetch origin develop:develop || true

      - name: Create or update PR develop -> main
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # Check if a PR already exists
          if gh pr list --base main --head develop --state open --json number --jq 'length' | grep -q '^0$'; then
            gh pr create \
              --base main \
              --head develop \
              --title "Daily Sync: develop → main" \
              --body $'This is an automated daily PR from `develop` to `main`.\n\n✅ Please review changes before merging.' \
              --label automated \
              --label daily-sync
          else
            echo "An open PR from develop to main already exists. Skipping creation."
          fi
